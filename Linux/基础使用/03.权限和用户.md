## shell运行原理
用户直接使用操作系统的门槛高，操作成本高且容易犯错。

所以用户一般通过操作系统提供的外壳程序来访问操作系统。

这个外壳程序在windows下可以是图形化界面，在linux下可以是shell。

> shell是linux下外壳程序的统称，而bash是其中的一种。

外壳程序的意义：
1. 是用户和操作系统的中间层
2. 在一定程度起到保护操作系统的作用

## 用户管理
linux下有两种用户，一种叫做root，一种叫做普通用户。

root用户为超级用户，一个操作系统只有一个，拥有linux下的最高权限，一般不受权限约束。

普通用户可以有多个，受权限约束。

每个用户都有自己的工作目录，在 `/home/`路径下，每个用户都有一个以用户名命名的文件夹。

> `root`用户的工作目录为 `/root/`
### 查看当前用户
```shell
whoami 
```

### 查看所有普通用户
```shell
ls /home 
```
> 在 `/home/`路径下，每个用户都有一个以用户名命名的文件夹。所以home路径的文件列表也是用户列表
### 创建新用户
创建用户
```shell
adduser 用户名
```
设置用户密码
```shell
passwd 用户名 密码
```
> 可以还需要输入用户信息，如全名，电话等
### 删除用户
```
userdel -r 用户名
```
### 修改密码
修改当前用户的密码
```shell
passwd
```
使用root用户时，可以修改所有用户的密码
```shell
passwd 用户名
```
### 切换用户
切换至超级用户
```shell
su
su -
```
> 直接使用`su`可以切换至超级用户，但加`-`会同时切换至工作目录
> 回车后需要输入root的密码(输入密码是不显示的，并非卡了)

切换至指定用户
```shell
su 用户名
```
超级用户切换至普通用户时不需要密码。普通用户切root 或者切换至另一个普通用户时需要密码。
## 文件属性
### 文件类型
linux操作系统不以文件后缀区分文件类型（但是也可以使用后缀来告诉用户文件类型）

`ls -l`显式的第一列的第一个字符表示文件的文件类型

- d：目录文件
- -：普通文件
- p：管道文件
- b：块设备
- c：字符设备
- l：链接文件 ：相当于windows下快捷方式
### 文件所属者
`ls -l` 的第三列就是文件的所属者。
### 文件所属组
`ls -l` 的第四列就是文件的所属组。

组也可以是单个用户。这个组只有这个用户。(默认每个用户有一个同名组，组内只有自己一个用户)

如果一个用户不是文件的所属者也不是文件的所属组，称为other。

## 权限管理
`ls -l`显示的第1列从第二个字符开始每三个字符为一组分别表示用户，组，other对此文件的操作权限
 - 第一个字符表示读权限，有则为`r`没有则为`-`
 -  第一个字符表示写权限，有则为`w`没有则为`-`
 -  第一个字符表示执行权限，有则为`x`没有则为`-`
 
> 注意root不受权限约束。具有所有文件的所有权限。
### 目录的权限

进入目录必须有执行权限

查看目录下的文件列表必须有读权限

在目录下创建和删除文件需要写权限
#### 粘滞位
只要有目录的写权限，就能删除目录中的文件，不论用户是否有文件的写权限。这在有些时候十分不合理。所以出现了粘滞位的概念。
```shell
chmod +t
```
> 当目录被设置为粘滞位，则其other的x权限将变为t
> 
> 粘滞位只能给目录设置。
>
> 只有设置粘滞位的用户才能取消粘滞位（root不受影响)。

当一个目录被设置为"粘滞位",则该目录下的文件只能由
1. 超级管理员删除
2. 该目录的所有者删除
3. 文件的所有者删除

### 添加和删除权限
有三种权限类型，读`r`，写`w`，执行`x`

有三种用户类型，拥有者`u`,拥有组`g`,other`o`

```shell
chmod 用户类型+权限类型 文件名
chmod 用户类型-权限类型 文件名
```
>给指定用户类型添加或删除指定权限，如
>```shell
>chmod u+rwx,g+rx,g-w,other-rwx file.txt
>```
>给拥有者添加所有权限，拥有组添加读和执行权限，删除写权限。other删除所有权限。

#### 8进制方案修改权限
可以用二进制数表示权限，`1`表示有，`0`表示没有。

用3位二进制数按顺序表示三种权限，转换为8进制则
 - 0：表示000，没有任何权限
 - 1：表示001，只有执行权限
 - 2：表示010，只有写权限
 - 3：表示011，有写和执行权限
 - 4：表示100，只有读权限
 - 5：表示101，只有读和执行权限
 - 6：表示110，只有读和写权限
 - 7：表示111，具有所有权限

用三个8进制数按顺序表示用户，组和other。分别赋予权限：
```shell
chomd 640 file.txt
```
> 6转换位二进制为111，表示拥有者具有所有权限
> 4转换成二进制为100，表示拥有组只有读权限
> 0转换成二进制为000，表示other没有任何权限
### 默认权限
当普通文件被创建时，默认权限是666
当目录文件被创建时，默认权限是777
#### umask
查看umask
```shell
umask
```
> umask是有个四位8进制数，后三位使用8进制方案表示权限

umask是Linux的默认文件权限掩码,默认权限减去umask是其实际权限。

> 比如umask是`012`，则新文件的权限为`654`（`666&(-012)`），新目录的权限为`765`（`777&(-102)`）
> 

### 强制使用root权限
普通用户可以强制使用root权限操作文件
```shell
su 具体操作指令
```

一般的普通用户不能这样做，必须在信任列表里才行。
```shell
su -
vim /etc/sudoers
```
> 切换至root用户打开此配置文件才能看到此配置文件的内容进行修改来添加指定用户信任列表

### 权限验证的机制
权限只会被验证一次，首先验证拥有者，然后验证组。最后验证other。

如果有这样一个文件
```shell
-r--rwx--- 1 拥有者 组 时间 文件名
```
你是这个文件的拥有者，此时你即使在组中有全部权限，但是因为拥有者验证成功，不会去验证组，所以你只有拥有者的读权限。


